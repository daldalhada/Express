# Socket.IO

<br>

## 1. 웹 소켓  

<br>

    - 실시간 양방향 데이터 전송을 위한 기술
    - 최신 브라우저는 대부분 웹 소켓을 지원함
    - Node는 ws나 Socket.IO 같은 패키지를 통해 웹 소켓 사용 가능
    - 웹 소켓은 연결도 한 번만 맺으면 되고, HTTP와 포트 공유도 가능하며, 성능도 매우 좋음

<br>

![socket](https://github.com/daldalhada/Express/blob/main/image/12/12-1/socket1.PNG)

[High Performance Browser Networking | O'Reilly](https://hpbn.co/websocket/)

<br>

    - 왼쪽 (long) polling 방식은 HTTP가 클라이언트에서 서버로만 요청이 가기 때문에 주기적으로 서버에 요청을 보내 업데이트가 있는지 확인함
      (30초마다 요청을 보낸다고 해도 매우 비효율적)
    - 중간 SSE(Server Sent Events) 방식은 처음에 한 번만 연결하면 서버가 클라이언트에 지속적으로 데이터를 보내줄 수 있음
      (단, 클라이언트에서 서버로는 데이터를 보낼 수 없음)
    - 오른쪽 웹 소켓은 연결도 한 번만 맺으면 되고, HTTP와 포트 공유도 가능하며, 성능도 매우 좋음

<br>

***

<br>

## 2. ws module

<br>

    - npm i express express-session cookie-parser dotenv morgan nunjucks 등 필요한 패키지 설치
    - npm i -D nodemon 
    - app.js, .env 등 필요한 파일 구성

<br>

```javascript

// app.js
const webSocket = require('./socket');

webSocket(server);

```

<br>

```javascript

// views/index.js

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>GIF 채팅방</title>
</head>
<body>
<div>F12를 눌러 console 탭과 network 탭을 확인하세요.</div>
<script>
  const webSocket = new WebSocket("ws://localhost:8005");
  webSocket.onopen = function () {
    console.log('서버와 웹소켓 연결 성공!');
  };
  webSocket.onmessage = function (event) {
    console.log(event.data);
    webSocket.send('클라이언트에서 서버로 답장을 보냅니다');
  };
</script>
</body>
</html>

```

<br>

```javascript

//socket.js

const WebSocket = require('ws');

module.exports = (server) => {
  const wss = new WebSocket.Server({ server });

  wss.on('connection', (ws, req) => { // 웹소켓 연결 시
    const ip = req.headers['x-forwarded-for'] || req.connection.remoteAddress;
    console.log('새로운 클라이언트 접속', ip);
    ws.on('message', (message) => { // 클라이언트로부터 메시지
      console.log(message);
    });
    ws.on('error', (error) => { // 에러 시
      console.error(error);
    });
    ws.on('close', () => { // 연결 종료 시
      console.log('클라이언트 접속 해제', ip);
      clearInterval(ws.interval);
    });

    ws.interval = setInterval(() => { // 3초마다 클라이언트로 메시지 전송
      if (ws.readyState === ws.OPEN) {
        ws.send('서버에서 클라이언트로 메시지를 보냅니다.');
      }
    }, 3000);
  });
};

```

<br>

    - 

<br>

***

<br>

## 3. 

<br>

```javascript



```

<br>

    - 

<br>

***

<br>

## 4. 

<br>

```javascript



```

<br>

    - 

<br>

***

<br>
