# API 서버

<br>

## 1. API(Application Programming Interface)

<br>

    - 다른 애플리케이션에서 현재 프로그램의 기능을 사용할 수 있게함
    - 웹 API: 다른 웹 서비스의 기능을 사용하거나 자원을 가져올 수 있게함 
    - 다른 사람에게 정보를 제공하고 싶은 부분만 API를 열면됨(크롤링으로 인한 DDos 공격을 막을 수 있음)
    - API에 제한을 걸어 일정 횟수 내에서만 가져가게 할 수 있음
    - 또한, 인증된 사용자에게만 정보를 제공할 수 있음

<br>

    - npm init으로 package.json 생성
    - npm i bcrypt cookie-parser dotenv express express-session morgan mysql2 nunjucks passport passport-local sequelize passport-kakao
    - npm i uuid (신규 패키지)
    - npi i -D nodemon

<br>

    - 초기 환경 세팅하기
    - config, models, passport, routes, views .env, app.js 구성

<br>

***

<br>

## 2. Domain Model 추가

<br>

```javascript

const Sequelize = require('sequelize');

module.exports = class Domain extends Sequelize.Model {
  static init(sequelize) {
    return super.init({
      host: {
        type: Sequelize.STRING(80),
        allowNull: false,
      },
      type: {
        type: Sequelize.ENUM('free', 'premium'),        // 상세 타입 열거(free, premium 둘 만 사용 가능)
        allowNull: false,
      },
      clientSecret: {
        type: Sequelize.STRING(36),                     // Sequelize.UUID(MySQL은 UUIDV4 지원X, Postgre는 지원 O)
        allowNull: false,
      },
    }, {
      sequelize,
      timestamps: true,
      paranoid: true,
      modelName: 'Domain',
      tableName: 'domains',
    });
  }

  static associate(db) {
    db.Domain.belongsTo(db.User);
  }
};

```

<br>

    - 다른 서버에서 데이터를 가져가는 것을 제한을 두기 위해 설정
    - 제한을 두려면 가져가는 사람이 누구인지를 알아야 함
    - NodeBird API 서버를 사용하기 위해 도메인을 설정해줘야 하는 방식
    - 위의 코드에서 clientSecret을 kakao Login에서 REST API키 처럼 사용
    - host는 주소는 kakao Login에서 recrect URI를 등록했던 것과 같은 역할

<br>

```javascript

// routes/index.js

router.post('/domain', isLoggedIn, async (req, res, next) => {
  try {
    await Domain.create({
      UserId: req.user.id,
      host: req.body.host,
      type: req.body.type,
      clientSecret: uuidv4(),
    });
    res.redirect('/');
  } catch (err) {
    console.error(err);
    next(err);
  }
});


```

<br>

    - uuid는 키 값을 만들어 줄 때 사용(32비트), 충돌이 날 가능성이 정말 희박하게 만들어줌
    - 버전 1(MAC), 버전 2(DCE 보안), 버전 3(MD5 해시), 버전 4(랜덤)

<br>

***

<br>

## 3. 

<br>



<br>

```javascript



```

<br>

    - 

<br>

```javascript



```

<br>

    - 

<br>

***

<br>
